本工具用于自动化测试模型参数


一、测试模式：

本工具目前提供两种自动测试方式：1）单模型测试；2）批量模型测试

1）单模型测试方式一次只测试一个模型，通过参数指定，这种方式可用于模型的常规测试、模型回归测试等

2）批量模型测试方式一次性测试多个模型，通过配置文件指定，这种方式用于模型的例行测试



二、使用方法

1、单模型测试

1）下载本代码库

2）切换路径到本地址

3）执行run_args_single.sh


run_args_single.sh执行方式：

sh run_args_single.sh model_path run_py func com_type

参数说明：

model_path: 所要测试的模型，例如PaddleNLP/language_model/

run_py: 模型的执行脚本，例如train.py

func: 所要测试的功能，train|infer|...

com_type: 预留参数，可随便设置


例：测试PaddleNLP/language_model/的训练过程

sh run_args_single.sh PaddleNLP/language_model/ train.py train 1


2、批量模型测试

1）下载本代码库

2）切换路径到本地址

3）执行run_args_batch.sh

run_args_batch.sh的执行方式：

sh run_args_batch.sh


批量模型测试中，模型需在conf/args_batch.conf中注册，格式及说明参考conf/README



三、添加模型自动化参数及脚本

使用本工具前，需添加模型自动化测试所需的参数test_args.py和预处理run_prepare.sh两个文件

两个文件存在同一级目录中，存放路径与https://github.com/PaddlePaddle/models 中的模型相对应


例如添加PaddleNLP/language_model/的参数和预处理脚本，其目录结构为：

PaddleNLP/language_model/test_args.py

PaddleNLP/language_model/run_prepare.sh



1、test_args.py

该文件存放模型需要测试的参数，参数以词典形式组织

其中key是参数名，value是参数值，value以列表的形式组织

例如：

train = {

        "use_gpu": [True, False],

        "parallel": [True, False],

        "profile": [True, False],

        "use_py_reader": [True, False],

        "max_epoch": [1, 2],

        "batch_size": [8, 16],

        "model_type": ["test", "small"],

        "rnn_model": ["static", "padding"],

        "data_path": ["data/simple-examples/data/", "data/simple-examples/data_1/"],

        "save_model_dir": ["models_1", "models_2"],

        "log_path": ["", "tmp_log_file"],

        }


2、run_prepare.sh

该文件用于设置运行模型所需的环境，例如数据准备、预训练模型准备等工作



四、测试数据

1、测试数据统一放在yq01-gpu-255-125-20-00:/ssd3/models_test/models_args/机器,在预处理脚本run_prepare.sh中，统一从该机器拉取，建议通过软链接准备数据，以便进行例行测试及提升速度、减少存储；single模式在本地修改run_prepare.sh获取数据的方式。

2、测试数据的大小不要太大，一个模型所有参数运行时间控制在30分钟以内。对于大多数模型，CPU运行通常较慢，对运行时间太长的模型，建议单独测试CPU。


